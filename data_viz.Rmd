---
title: "dataviz_intro"
output: html_document
date: "2022-09-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Intro HW:

2 Motivation and Grammar of Graphics

Review Exercises:

Exercise 1. In the above plots, we skipped the final “two variable” combination: one quantitative variable and one categorical variable. Create either a side-by-side boxplot or side-by-side violin plot of a quantitative and a categorical variable in the penguins data set.
```{r}
library(palmerpenguins)
library(tidyverse)
ggplot(penguins, aes(x = species, y = bill_length_mm)) +
  geom_boxplot()
ggplot(penguins, aes(x = species, y = bill_length_mm)) +
  geom_violin()
```

Exercise 2. Modify the frequency plot made with geom_freqpoly() to use colour in two different ways:
change the colour of the line to any colour that R knows. A list of some colours can be found at this link.
add a colour asethetic to make three different frequency lines, one for each species of penguin.
Hint: recall that only aesthetic mappings (variables) go inside aes(). Of (a) or (b), which one is an aesthetic mapping?
```{r}
ggplot(data = penguins, aes(x = bill_length_mm)) +
  geom_freqpoly(colour = "red")

ggplot(data = penguins, aes(x = bill_length_mm, color = species)) +
  geom_freqpoly()
```

Exercise 3. Thus far, we have only plotted one or two variables at a time. Recall that one way to construct a plot of three different variables is to use colour. Modify the scatterplot so that the points are coloured by species.
```{r}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +
  geom_point() +
  geom_smooth()
```

Exercise 4. Recall that aes() aesthetics specified within the ggplot() function directly are called global aesthetics because every other GEOM will use them (unless specifically overridden) while aes() specified within a particular GEOM are called local aesthetics because only that particular GEOM will use them.
Modify the scatterplot and smoother so that
- the points are coloured by species, but there is only one smoother instead of three.
- there are three different coloured smoothers (one for each species) but the points are all the same colour.
```{r}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point(aes(color = species)) +
  geom_smooth()

ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point() +
  geom_smooth(aes(color = species))
```

Exercise. Make a plot of the penguins data that explicitly specifies all 7 parameters in the grammar of graphics, even if you just explicitly specify the default for some of the parameters.
```{r}
ggplot(data = penguins, aes(x = island, fill = sex)) + 
  geom_bar(stat = "count", position = "dodge") +
  coord_flip() +
  facet_wrap(~ species)
```


-----------------------------

3.2: Data Visualization Concepts - Part 1

1. Using either Anscombe’s quartet or the income/voter turnout graph as an example, explain why it’s valuable to look at data graphically instead of examining data only with summary statistics.
Anscombe's quartet shows four data sets in which the numerically calculated means are the same but the visual differences are apparent.

2. Take a look at the bar plot in Figure 1.4. Give a couple of reasons for why the chart has “bad taste.”
Hard to tell x value. Key repeats y value info.

3. Why might you not always want to maximize the data-to-ink ratio when making charts?
harder to interpret and less memorable.

4. What do the authors mean when they say that “relative comparisons need a stable baseline” and how does that affect your ability to interpret the coloured stacked bar plot in Figure 1.11?
In order to compare values, they should start at the same point to be able to easily see the relative heights. So for the stacked bar plot, the bottom row all have the stable baseline of the x axis allowing comparison, but the next rows start at different values so are not as easily compared.

5. What are two key takeaways from Sections 1.1 and 1.2?
perception influences viz quality. also data intepretability.

6. What is one question that you have about the reading?
how can i customize my vizs in R to my own aesthetic liking?

--------------

3.3 Data Visualization Concepts: Part 2 
(quiz 1 take home)

1. hue = color. intensity = vividness

2. Think of an example where you would want to use a sequential colour scale that’s different from the one given in the text. Then, think of examples where you would use a diverging colour scale and an unordered colour scale.
bright yellow to black for night to day?
diverging - politics.
unordered - visualizing categorical, non-ordered variables.

3. Some gestalt inferences take priority over others. Using Figure 1.21, give an example of a gestalt inference that takes priority over another one.
for the top right colored circles, the similarity inference takes priority over the proximity inference.

4. “Bar charts are better than Pie charts for visualizing a single categorical variable.” Explain how results shown in Figure 1.23 support this claim.
The log error when estimating the size difference between data points for a single categorical varialbe are in the 1 to 1.75 range, while for a pie chart the log error is on average 2 to 2.4.


5. Suppose you have a scatterplot of height on the y-axis vs. weight on the x-axis for people born in Canada, Mexico, and the United States. You now want to explore whether the relationship is different for people born in the United States, people born in Canada, and people born in Mexico. Should you use different shapes to distinguish the three countries or should you use different colours? Explain using either Figure 1.24 or 1.25.
1.25 shows that color hue is better for differentiation than shape.


6. When might you use the left-side of Figure 1.27 to show the law school data? When might you use the right-side of Figure 1.27 to show the law school data?
The graph on the left is beneficial to point out the drastic drop in enrollment, more to see a comparison -- while the right shows the continued high enrollment rates despite any dropoff.

7. Summary: What are two takeaways from Sections 1.3-1.7?
Non-zero axis starting points emphssize changee over actual number. 
bar graphs are the most effective for accurate visual comprehension.

8. What is one question that you have about the reading?
What is the checks and balance system -- if i publish research with a moral and correct graph that has slight bias of wanting to confirm my own hypothesis, how is that critiqued?

--------------------------------

5 tidyverse Review

5.1.1 Exercises
Exercise 1. Make the visualization that we sketched in class. We will complete this exercise as a class.
Exercise 2. There is a minor flaw in the way that we counted up the number of hits for each artist. Examine the 2nd to last row of the original data set with tail() to look at this potential flaw. What do you find?
Exercise 3. Challenging. Fix the issue in Exercise 2. May want to skip this question and come back after completing the other exercises.
```{r}
library(tidyverse)
library(billboard)

hot_100s <- wiki_hot_100s %>%
  filter(year >= 2000 & year <= 2009) %>%
  separate(col = artist, into = c("artist", "featured_artist"), 
           sep = " featuring ") %>%
  count(artist) %>%
  arrange(desc(n)) %>%
  slice(1:20) %>%
  mutate(artist = fct_reorder(artist, n))
  
ggplot(hot_100s, aes(x = artist, y=n)) +
  geom_col() +
  coord_flip()

```

Exercise 4. Change the plot from Exercise 1 to be a Lollipop chart using this website as a reference. Why might the lollipop chart be better than a bar plot?
Exercise 5. Use this website to customize the end points of your lollipop chart. If you have time, you can explore the other customization options. Make it look fancy!
```{r}
ggplot(data = hot_100s, aes(x = artist, y = n)) +
  geom_point() + 
  geom_segment(aes(x = artist, xend = artist, y = 0, yend = n)) +
  coord_flip() +
  labs(x = "Artist Name", 
       y = "Number of Songs in Top 100")+
  theme_light() +
  theme(
    panel.grid.major.x = element_blank(),
    panel.border = element_blank(),
    axis.ticks.x = element_blank()
  )
```

-----------------------------

quiz 1 - in person

1. The trends of group five are easiest to analyze, as they have a stable baseline, the x axis, that allow for easy relative comparison.

2. 
```{r}
library(tidyverse)
category <- rep(c("Group 1", "Group 2", "Group 3", "Group 4", "Group 5"), 7)
time <- rep(c(2000, 2001, 2002, 2003, 2004, 2005, 2006), each = 5) 
response <- rpois(length(category), 30)
df <- tibble(category, time, response)
ggplot(data = df, aes(x = time, y = response)) +
  geom_col() +
  labs(y = "count") +
  facet_wrap(~category)
```

3a. Diverging -- a positive change would be one color, a negative change the opposite color, and no change the neutral middle color.

3b. Sequential -- allows light at 0 and increasing darkness with increasung number of cases.

4. <COORDINATE_FUNCTION>

5a. 
```{r}
ggplot(data = df, aes(x = time, y = response)) +
  geom_point(colour = "blue")
```
Remove the aes() from around the color assignment, as the aes() assumes you will be assigning color a variable and not a constant color.

5b. 
```{r}
ggplot(data = df, aes(x = time, y = response)) +
  geom_point(aes(colour = category)) +
  geom_smooth(se = FALSE, span = 1.9)
```
move the aes() mapping of colour to the geom_point() mapping, as that will make the categorization only occur for the points while the smooth applies to the data as a whole from the ggplot() mapping. 


------------------
QUIZ 2 TAKEHOME

```{r}
library(tidyverse)
library(readxl)
df <- read_excel("data/slu_graduates_17_21.xlsx")

## fixes error in the data
df <- df %>% mutate(across(everything(),
                           .fns = ~replace(., . ==  "STATS" , "STAT")))
```

Question 1 (7 points). Make the following chart that shows the “other” majors of each STAT major student in the data set. Hint: You will need dplyr and forcats: it may be helpful to use some STAT 234 materials linked here to reference the bar plot made for Pokemon Type.
```{r}
df_long <- df |> filter(major1 == "STAT" | major2 == "STAT" | major3 == "STAT") |>
  pivot_longer(3:8, names_to = "type", values_to = "discipline")

df_major <- df_long %>% 
  filter(type == "major1" | type == "major2" | type == "major3")

df_major <- df_major |>
  group_by(discipline) |>
  summarise(count_type = n()) |>
  filter(!is.na(discipline) & !discipline == "STAT")|> 
  mutate(discipline = fct_reorder(.f = discipline, .x = count_type))

ggplot(data = df_major, aes(x = discipline,
                               y = count_type)) +
  geom_col() +
  coord_flip()
```

Question 2 (8 points). Make the following lollipop graphic, which investigates the sex disparity of majors at SLU with 50 or more total graduates in the past few years. The y-axis is the major while the x-axis is the proportion of majors who identified as Female. Note that the graph shown below eliminates some of the majors because I want you to discover the final trends on your own! Remember that your graphic should only include all of the majors with 50 or more total graduates.
```{r}
df_long <- df %>% pivot_longer(3:8, names_to = "type", values_to = "discipline")

df_major <- df_long %>% 
  filter(type == "major1" | type == "major2" | type == "major3") |>
  filter(!is.na(discipline)) |>
  group_by(discipline) |>
  mutate(students_with_major = n())|>
  ungroup() |>
  filter(students_with_major >= 50 & sex == "F")|>
  group_by(discipline) |>
  mutate(count_fem = n()) |>
  ungroup() |>
  summarise(discipline = discipline, perc = count_fem / students_with_major) |>
  mutate(discipline = fct_reorder(discipline, perc))

ggplot(data = df_major, aes(x = discipline, y = perc)) +
  geom_point() + 
  geom_segment(aes(x = discipline, xend = discipline, y = 0, yend = perc)) +
  coord_flip() 
```


-----------------------------
QUIZ 2 INCLASS
```{r}
library(tidyverse)
library(readxl)
df <- read_excel("data/slu_graduates_17_21.xlsx")

## fixes error in the data
df <- df %>% mutate(across(everything(),
                           .fns = ~replace(., . ==  "STATS" , "STAT")))

df_long <- df %>% pivot_longer(3:8, names_to = "type", values_to = "discipline")

df_major <- df_long %>% 
  filter(type == "major1" | type == "major2" | type == "major3")
```

Question 1 (10 points). Make a lollipop chart of the counts of the top 10 most popular majors at SLU in the past five years, ordering the “lollies” from the most popular major to the 10th most popular major.
```{r}
df_major_quiz <- df_major |>
  filter(!is.na(discipline)) |>
  group_by(discipline) |>
  summarize(students_with_major = n())|>
  ungroup() %>%
  arrange(desc(discipline)) %>%
  slice(1:10) |>
  mutate(discipline = fct_reorder(discipline, students_with_major))


ggplot(data = df_major_quiz, aes(x = discipline, y = students_with_major)) +
  geom_point() + 
  geom_segment(aes(x = discipline, xend = discipline, y = 0, yend = students_with_major)) +
  coord_flip() 
```


Question 2 (10 points). Make the plot from Question 1 of the take-home quiz, but, instead of plotting the other majors of all of the STAT majors in the data set, plot the counts of the minors of all of the STAT majors.
```{r}
df_long_minors <- df |> 
  filter(major1 == "STAT" | major2 == "STAT" | major3 == "STAT") |>
  pivot_longer(3:8, names_to = "type", values_to = "discipline")

df_minors <- df_long_minors |>
  filter(type == "minor1" | type == "minor2" | type == "minor3") |>
  filter(!is.na(discipline) & discipline != "STAT") %>%
  group_by(discipline) |>
  summarise(count_type = n()) |>
  mutate(discipline = fct_reorder(.f = discipline, .x = count_type))

ggplot(data = df_minors, aes(x = discipline,
                               y = count_type)) +
  geom_col() +
  coord_flip()
```


Question 3 (5 points). Push your .Rmd and knitted .html file to GitHub, writing a one sentence commit message for your push.

Extra Credit (1 point). For just a single point of extra credit (the purpose of this is mostly to give anyone who finishes the quiz early something to work on), figure out the “average” number of majors SLU students had over the past 5 years. For example, if the data only had three students: two single majors and one double major, the “average” number of majors would be (1 + 1 + 2) / 4 = 1.33 majors.