Libraries
```{r}
library(tidyverse)
library(ggbeeswarm) #swarm plot
library(tidytext) #get sentiments
```

Data
```{r}
# BY AUTHOR POSITIONALITY
wm_unnest_auth <- read_csv("data/wm_unnest_auth") %>% select(!1)
wf_unnest_auth <- read_csv("data/wf_unnest_auth")%>% select(!1)
bf_unnest_auth <- read_csv("data/bf_unnest_auth")%>% select(!1)
wm_auth <- read_csv("data/wm_auth") %>% select(!1)
wf_auth <- read_csv("data/wf_auth")%>% select(!1)
bf_auth <- read_csv("data/bf_auth")%>% select(!1)

#all novels together

novel_list_auth <- list(wm_auth, wf_auth, bf_auth)


# BY PROTAG POSITIONALITY
wm_unnest_char <- read_csv("data/wm_unnest_char")%>% select(!1)
wf_unnest_char <- read_csv("data/wf_unnest_char")%>% select(!1)
bf_unnest_char <- read_csv("data/bf_unnest_char")%>% select(!1)
wm_char <- read_csv("data/wm_char")%>% select(!1)
wf_char <- read_csv("data/wf_char")%>% select(!1)
bf_char <- read_csv("data/bf_char")%>% select(!1)

#all novels together

novel_list_char <- list(wm_char, wf_char, bf_char)


# BY GENDER PROTOG
fem_unnest_char_gender <- read_csv("data/fem_unnest_char_gender")
male_unnest_char_gender <- read_csv("data/male_unnest_char_gender")
fem_char_gender <- read_csv("data/fem_char_gender")
male_char_gender <- read_csv("data/male_char_gender")

#all novels together

novel_list_char_gender <- list(fem_char_gender, male_char_gender)


# BY GENDER AUTH
fem_unnest_auth_gender <- read_csv("data/fem_unnest_auth_gender")%>% select(!1)
male_unnest_auth_gender <- read_csv("data/male_unnest_auth_gender")%>% select(!1)
fem_auth_gender <- read_csv("data/fem_auth_gender")%>% select(!1)
male_auth_gender <- read_csv("data/male_auth_gender")%>% select(!1)

#all novels together

novel_list_auth_gender <- list(fem_auth_gender, male_auth_gender)


# RACE
w_unnest <- read_csv("data/w_unnest") %>% select(!1)
b_unnest <- read_csv("data/b_unnest")%>% select(!1)
w <- read_csv("data/w")%>% select(!1)
b <- read_csv("data/b")%>% select(!1)

#all novels together

novel_list_race <- list(w, b) 
```

DFs
```{r}
novels_with_stop_list_auth <- bind_rows()

all_novels_auth <- read_csv("data/all_novels_auth")
all_novels_char <- read_csv("data/all_novels_char")

sent_per <- read_csv("data/sent_per")

top_10_words_wm_auth <- read_csv("data/top_10_words_wm_auth")
top_10_words_wf_auth <- read_csv("data/top_10_words_wf_auth")
top_10_words_bf_auth <- read_csv("data/top_10_words_bf_auth")
```


Frequency of MH words
```{r}
MHcount <- combo %>%
  inner_join(MH) %>%
  group_by(doc_id) %>%
  summarise(positionality = positionality, 
            mh_tot = n(), mh_perc = mh_tot / tot_words) %>%
  ungroup() %>% distinct()

MHcount %>%
  ggplot(aes(x= positionality, y=mh_perc, color = positionality)) +
  geom_beeswarm(cex = 3) +
  labs(x = "Positionality",
       y = "Percentage of Mental Health Terms") + 
  theme(legend.position = "none") +
  scale_colour_brewer(palette = "Accent") +
  stat_summary(
    geom = "point",
    fun = "mean",
    col = "black",
    size = 1,
    shape = 24,
    fill = "black"
  )

#table - USE AS TABLE REF FOR ANY I WANT TABLE FOR
MHcount_table <- MHcount %>% 
  arrange(desc(mh_perc))
MHcount_table %>% kable()
```

Running shiny app
```{r}


library(shiny)

ui <- fluidPage(

  titlePanel("The Interaction of Mental Health and Positionality in Literature"),

  sidebarLayout(
    
    sidebarPanel(
      # Inputs 
      radioButtons("positionality_choice", label = "What aspects of positionality do you want to investigate?", choices = c("Gender and Race", "Race", "Gender")),
      selectizeInput("viz_choice",
                                label = "What would you like to visualize?", 
                                choices = c("Most common words used", "Sentiment score per novel", "NRC emotion percentages", "Most common mental health words", "Frequency of mental health terms in novel","Frequency of derogatory mental health words","Ratio of derogatory to non-derogatory words","Sentiment +-10 words around mental health words"),
                                selected = "Most common words used")
    ),
  
    mainPanel(
      tabsetPanel(
        # tabs and reactive visuals
        tabPanel("Project Overview", textOutput("overview")),
        tabPanel("Positionality of Author", plotOutput("plot_1")), 
        tabPanel("Positionality of Protagonist", plotOutput("plot_2")) #,
        #tabPanel("Sentiment Analysis of Each Novel", plotOutput("plot_3"))
        
      )
    )
  )
)
  

server <- function(input, output, session) {
  # #attempt at text outputs
  # output$overview <- renderUI({
  #  str1 <- paste("You have selected")
  #  str2 <- paste("You have chosen a range that goes from")
  #  HTML(paste(str1, str2, sep = '<br/>'))
  #  # HTML('<h1>My First Heading</h1>',
  #        # '<p>My first paragraph.</p>')
  # })

  
#REACTIVE EXPRESSIONS
  
  
#AUTHOR 
  
#TOP WORDS AUTH 
#   top_10_words_auth <- function(data_set) {
#   data_set %>% 
#   ggplot(aes(tot_freq, word)) +
#   geom_col()
# }
# map(novel_list, top_10_words_graph_perc)
  
  
  
top_10_words_wm_auth <- reactive({
    top_10_words_wm_auth %>% filter(positionality_choice == input$positionality_choice)
  })
  
     
#SENT PER NOVEL AUTH
sent_per_input_auth <- reactive({
    sent_per %>% filter(positionality_choice == input$positionality_choice) %>%
    filter(choice == "auth")
  })
  

 #NRC emotion percentages auth
 nrc_auth <- reactive({
   all_novels_auth %>% 
     filter(positionality_choice == input$positionality_choice) %>%
    inner_join(get_sentiments("nrc")) %>%
  group_by(positionality) %>%
  mutate(tot_words = sum(tot_words)) %>%
  ungroup() %>%
  count(sentiment, positionality, tot_words) %>%
  mutate(perc = n/tot_words)
    })
  

#Most common mental health words auth


#Frequency of mental health terms in novel auth 


#Frequency of derogatory mental health words auth


#Ratio of derogatory to non-derogatory words


#sentiment +-10 words around mental health words auth

#-----------------------------------------------------------------------#

#CHARACTER

#top 10 words char


#sent per char
sent_per_input_char <- reactive({
    sent_per %>% filter(positionality_choice == input$positionality_choice) %>%
    filter(choice == "char")
  })
 

#NRC emotion percentages char
 nrc_char <- reactive({
   all_novels_char %>% 
     filter(positionality_choice == input$positionality_choice) %>%
    inner_join(get_sentiments("nrc")) %>%
  group_by(positionality) %>%
  mutate(tot_words = sum(tot_words)) %>%
  ungroup() %>%
  count(sentiment, positionality, tot_words) %>%
  mutate(perc = n/tot_words)
    })

#Most common mental health words char


#Frequency of mental health terms in novel char 


#Frequency of derogatory mental health words char


#Ratio of derogatory to non-derogatory char


#sentiment +-10 words around mental health words char

#------------------------------------------------------------------#

  # Use a reactive expression by calling it like a function
#AUTHOR  
  output$plot_1 <- renderPlot({
     if(input$viz_choice == "Most common words used") {
       
     } else { if (input$viz_choice == "Sentiment score per novel") {
       ggplot(data = sent_per_input_auth(),
       aes(x = positionality, y = perc, color = positionality)) +
  geom_beeswarm(cex = 3) +
  facet_wrap(~ method) +
  theme(legend.position = "none") +
   scale_colour_brewer(palette = "Accent") +
  stat_summary(
    geom = "point",
    fun = "mean",
    col = "black",
    size = 1,
    shape = 24,
    fill = "black"
  )
     }
      else { if (input$viz_choice == "NRC emotion percentages" ) {
       ggplot(data = nrc_auth(), aes(x=positionality, y=perc)) +
  facet_wrap(~sentiment) +
  geom_col()
     }
      else { if (input$viz_choice == "Most common mental health words") {
       #most_common_mh_auth()
     }
      else { if (input$viz_choice == "Frequency of mental health terms in novel") {
       #freq_mh_auth()
     }
      else { if (input$viz_choice == "Ratio of derogatory to non-derogatory words") {
       #ratio_derog_auth()
     }
      else { if (input$viz_choice == "Sentiment +-10 words around mental health words") {
       #around_mh_auth()
     }
     }}}}}}
     })
                

#CHARACTER
  output$plot_2 <- renderPlot({
     if(input$viz_choice == "Most common words used") {
       
     } else { if (input$viz_choice == "Sentiment score per novel") {
       ggplot(data = sent_per_input_char(),
       aes(x = positionality, y = perc, color = positionality)) +
  geom_beeswarm(cex = 3) +
  facet_wrap(~ method) +
  theme(legend.position = "none") +
   scale_colour_brewer(palette = "Accent") +
  stat_summary(
    geom = "point",
    fun = "mean",
    col = "black",
    size = 1,
    shape = 24,
    fill = "black"
  )
     }
      else { if (input$viz_choice == "NRC emotion percentages" ) {
       ggplot(data = nrc_char(), aes(x=positionality, y=perc)) +
  facet_wrap(~sentiment) +
  geom_col()
     }
      else { if (input$viz_choice == "Most common mental health words") {
       #most_common_mh_auth()
     }
     else { if (input$viz_choice == "Frequency of mental health terms in novel") {
       #freq_mh_auth()
     }
      else { if (input$viz_choice == "Ratio of derogatory to non-derogatory words") {
       #ratio_derog_auth()
     }
      else { if (input$viz_choice == "Sentiment +-10 words around mental health words") {
       #around_mh_auth()
     }
     }}}}}}
     })

 }

shinyApp(ui, server)

```


